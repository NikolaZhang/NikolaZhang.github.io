import{_ as e}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as t,c as p,a as n,b as s,d as o,w as i,e as c,r as l}from"./app.e7c9cb9e.js";const u={},r=n("blockquote",null,[n("p",null,"\u5F53Item\u5728Spider\u4E2D\u88AB\u6536\u96C6\u4E4B\u540E\uFF0C\u5B83\u5C06\u4F1A\u88AB\u4F20\u9012\u5230Item Pipeline\uFF0C\u4E00\u4E9B\u7EC4\u4EF6\u4F1A\u6309\u7167\u4E00\u5B9A\u7684\u987A\u5E8F\u6267\u884C\u5BF9Item\u7684\u5904\u7406\u3002")],-1),d=n("p",null,"\u6BCF\u4E2Aitem pipeline\u7EC4\u4EF6(\u6709\u65F6\u79F0\u4E4B\u4E3A\u201CItem Pipeline\u201D)\u662F\u5B9E\u73B0\u4E86\u7B80\u5355\u65B9\u6CD5\u7684Python\u7C7B\u3002\u4ED6\u4EEC\u63A5\u6536\u5230Item\u5E76\u901A\u8FC7\u5B83\u6267\u884C\u4E00\u4E9B\u884C\u4E3A\uFF0C\u540C\u65F6\u4E5F\u51B3\u5B9A\u6B64Item\u662F\u5426\u7EE7\u7EED\u901A\u8FC7pipeline\uFF0C\u6216\u662F\u88AB\u4E22\u5F03\u800C\u4E0D\u518D\u8FDB\u884C\u5904\u7406\u3002",-1),k=n("p",null,"\u4EE5\u4E0B\u662Fitem pipeline\u7684\u4E00\u4E9B\u5178\u578B\u5E94\u7528\uFF1A",-1),m=n("ul",null,[n("li",null,"\u6E05\u7406HTML\u6570\u636E"),n("li",null,"\u9A8C\u8BC1\u722C\u53D6\u7684\u6570\u636E(\u68C0\u67E5item\u5305\u542B\u67D0\u4E9B\u5B57\u6BB5)"),n("li",null,"\u67E5\u91CD(\u5E76\u4E22\u5F03)"),n("li",null,"\u5C06\u722C\u53D6\u7ED3\u679C\u4FDD\u5B58\u5230\u6570\u636E\u5E93\u4E2D")],-1),v={id:"\u7F16\u5199\u4F60\u81EA\u5DF1\u7684item-pipeline\xB6",tabindex:"-1"},h=n("a",{class:"header-anchor",href:"#\u7F16\u5199\u4F60\u81EA\u5DF1\u7684item-pipeline\xB6","aria-hidden":"true"},"#",-1),b=c(`<p>\u7F16\u5199\u4F60\u81EA\u5DF1\u7684item pipeline\u5F88\u7B80\u5355\uFF0C\u6BCF\u4E2Aitem pipeline\u7EC4\u4EF6\u662F\u4E00\u4E2A\u72EC\u7ACB\u7684Python\u7C7B\uFF0C\u540C\u65F6\u5FC5\u987B\u5B9E\u73B0\u4EE5\u4E0B\u65B9\u6CD5:</p><blockquote><p><code>process_item</code>(<em>self</em>,\xA0<em>item</em>,\xA0<em>spider</em>)</p></blockquote><p>\u6BCF\u4E2Aitem pipeline\u7EC4\u4EF6\u90FD\u9700\u8981\u8C03\u7528\u8BE5\u65B9\u6CD5\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u5FC5\u987B\u8FD4\u56DE\u4E00\u4E2A\xA0<code>[Item](https://scrapy-chs.readthedocs.io/zh_CN/latest/topics/items.html#scrapy.item.Item)</code>\xA0(\u6216\u4EFB\u4F55\u7EE7\u627F\u7C7B)\u5BF9\u8C61\uFF0C \u6216\u662F\u629B\u51FA\xA0<code>[DropItem](https://scrapy-chs.readthedocs.io/zh_CN/latest/topics/exceptions.html#scrapy.exceptions.DropItem)</code>\xA0\u5F02\u5E38\uFF0C\u88AB\u4E22\u5F03\u7684item\u5C06\u4E0D\u4F1A\u88AB\u4E4B\u540E\u7684pipeline\u7EC4\u4EF6\u6240\u5904\u7406\u3002</p><p>\u53C2\u6570:</p><p>\u2022 <strong>item</strong>\xA0(<code>[Item](https://scrapy-chs.readthedocs.io/zh_CN/latest/topics/items.html#scrapy.item.Item)</code>\xA0\u5BF9\u8C61) \u2013 \u88AB\u722C\u53D6\u7684item</p><p>\u2022 <strong>spider</strong>\xA0(<code>[Spider](https://scrapy-chs.readthedocs.io/zh_CN/latest/topics/spiders.html#scrapy.spider.Spider)</code>\xA0\u5BF9\u8C61) \u2013 \u722C\u53D6\u8BE5item\u7684spider</p><blockquote><p><strong><code>open_spider</code>(<em>self</em>,\xA0<em>spider</em>)</strong></p></blockquote><p>\u5F53spider\u88AB\u5F00\u542F\u65F6\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u88AB\u8C03\u7528\u3002</p><p>\u53C2\u6570:</p><p><strong>spider</strong>\xA0(<strong><code>[Spider](https://scrapy-chs.readthedocs.io/zh_CN/latest/topics/spiders.html#scrapy.spider.Spider)</code></strong>\xA0\u5BF9\u8C61) \u2013 \u88AB\u5F00\u542F\u7684spider</p><blockquote><p><strong><code>close_spider</code>(<em>spider</em>)</strong></p></blockquote><p>\u5F53spider\u88AB\u5173\u95ED\u65F6\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u88AB\u8C03\u7528</p><p>\u53C2\u6570:</p><p><strong>spider</strong>\xA0(<strong><code>[Spider](https://scrapy-chs.readthedocs.io/zh_CN/latest/topics/spiders.html#scrapy.spider.Spider)</code></strong>\xA0\u5BF9\u8C61) \u2013 \u88AB\u5173\u95ED\u7684spider</p><blockquote><p><strong><code>from_crawler</code>(<em>cls</em>,\xA0<em>crawler</em>)</strong></p></blockquote><p>If present, this class method is called to create a pipeline instance from a\xA0<strong><code>[Crawler](https://scrapy-chs.readthedocs.io/zh_CN/latest/topics/api.html#scrapy.crawler.Crawler)</code></strong>. It must return a new instance of the pipeline. Crawler object provides access to all Scrapy core components like settings and signals; it is a way for pipeline to access them and hook its functionality into Scrapy.</p><p>\u53C2\u6570:</p><p><strong>crawler</strong>\xA0(<strong><code>[Crawler](https://scrapy-chs.readthedocs.io/zh_CN/latest/topics/api.html#scrapy.crawler.Crawler)</code></strong>\xA0object) \u2013 crawler that uses this pipeline</p><h2 id="\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u6848\u4F8B" aria-hidden="true">#</a> \u6848\u4F8B</h2><h3 id="\u9A8C\u8BC1-\u540C\u65F6\u4E22\u5F03" tabindex="-1"><a class="header-anchor" href="#\u9A8C\u8BC1-\u540C\u65F6\u4E22\u5F03" aria-hidden="true">#</a> \u9A8C\u8BC1\uFF0C\u540C\u65F6\u4E22\u5F03</h3><p>\u8BA9\u6211\u4EEC\u6765\u770B\u4E00\u4E0B\u4EE5\u4E0B\u8FD9\u4E2A\u5047\u8BBE\u7684pipeline\uFF0C\u5B83\u4E3A\u90A3\u4E9B\u4E0D\u542B\u7A0E(price_excludes_vat \u5C5E\u6027)\u7684item\u8C03\u6574\u4E86 price \u5C5E\u6027\uFF0C\u540C\u65F6\u4E22\u5F03\u4E86\u90A3\u4E9B\u6CA1\u6709\u4EF7\u683C\u7684item:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> DropItem

<span class="token keyword">class</span> <span class="token class-name">PricePipeline</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    vat_factor <span class="token operator">=</span> <span class="token number">1.15</span>
    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token string">&#39;price_excludes_vat&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                item<span class="token punctuation">[</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>vat_factor
            <span class="token keyword">return</span> item
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> DropItem<span class="token punctuation">(</span><span class="token string">&quot;Missing price in %s&quot;</span> <span class="token operator">%</span> item<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5199\u5165json" tabindex="-1"><a class="header-anchor" href="#\u5199\u5165json" aria-hidden="true">#</a> \u5199\u5165json</h3><p>\u4EE5\u4E0Bpipeline\u5C06\u6240\u6709(\u4ECE\u6240\u6709spider\u4E2D)\u722C\u53D6\u5230\u7684item\uFF0C\u5B58\u50A8\u5230\u4E00\u4E2A\u72EC\u7ACB\u5730 items.jl \u6587\u4EF6\uFF0C\u6BCF\u884C\u5305\u542B\u4E00\u4E2A\u5E8F\u5217\u5316\u4E3AJSON\u683C\u5F0F\u7684item:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> json

<span class="token keyword">class</span> <span class="token class-name">JsonWriterPipeline</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;items.jl&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;wb&#39;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        line <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\n&quot;</span>
        self<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
        <span class="token keyword">return</span> item
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5199\u5165mongodb" tabindex="-1"><a class="header-anchor" href="#\u5199\u5165mongodb" aria-hidden="true">#</a> \u5199\u5165MongoDB</h3><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pymongo

<span class="token keyword">class</span> <span class="token class-name">MongoPipeline</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mongo_uri<span class="token punctuation">,</span> mongo_db<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>mongo_uri <span class="token operator">=</span> mongo_uri
        self<span class="token punctuation">.</span>mongo_db <span class="token operator">=</span> mongo_db

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">from_crawler</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> crawler<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> cls<span class="token punctuation">(</span>
            mongo_uri<span class="token operator">=</span>crawler<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;MONGO_URI&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            mongo_db<span class="token operator">=</span>crawler<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;MONGO_DATABASE&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;items&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">open_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span>MongoClient<span class="token punctuation">(</span>self<span class="token punctuation">.</span>mongo_uri<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>db <span class="token operator">=</span> self<span class="token punctuation">.</span>client<span class="token punctuation">[</span>self<span class="token punctuation">.</span>mongo_db<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">close_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        collection_name <span class="token operator">=</span> item<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__
        self<span class="token punctuation">.</span>db<span class="token punctuation">[</span>collection_name<span class="token punctuation">]</span><span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> item
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u53BB\u91CD" tabindex="-1"><a class="header-anchor" href="#\u53BB\u91CD" aria-hidden="true">#</a> \u53BB\u91CD</h3><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> DropItem

<span class="token keyword">class</span> <span class="token class-name">DuplicatesPipeline</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ids_seen <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">]</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>ids_seen<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> DropItem<span class="token punctuation">(</span><span class="token string">&quot;Duplicate item found: %s&quot;</span> <span class="token operator">%</span> item<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>ids_seen<span class="token punctuation">.</span>add<span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> item
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u542F\u7528\u4E00\u4E2Aitem-pipeline\u7EC4\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u542F\u7528\u4E00\u4E2Aitem-pipeline\u7EC4\u4EF6" aria-hidden="true">#</a> \u542F\u7528\u4E00\u4E2AItem Pipeline\u7EC4\u4EF6</h2><p>\u4E3A\u4E86\u542F\u7528\u4E00\u4E2AItem Pipeline\u7EC4\u4EF6\uFF0C\u4F60\u5FC5\u987B\u5C06\u5B83\u7684\u7C7B\u6DFB\u52A0\u5230 ITEM_PIPELINES \u914D\u7F6E\uFF0C\u5C31\u50CF\u4E0B\u9762\u8FD9\u4E2A\u4F8B\u5B50:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;myproject.pipelines.PricePipeline&#39;</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
    <span class="token string">&#39;myproject.pipelines.JsonWriterPipeline&#39;</span><span class="token punctuation">:</span> <span class="token number">800</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5206\u914D\u7ED9\u6BCF\u4E2A\u7C7B\u7684\u6574\u578B\u503C\uFF0C\u786E\u5B9A\u4E86\u4ED6\u4EEC\u8FD0\u884C\u7684\u987A\u5E8F\uFF0Citem\u6309\u6570\u5B57\u4ECE\u4F4E\u5230\u9AD8\u7684\u987A\u5E8F\uFF0C\u901A\u8FC7pipeline\uFF0C\u901A\u5E38\u5C06\u8FD9\u4E9B\u6570\u5B57\u5B9A\u4E49\u57280-1000\u8303\u56F4\u5185\u3002</p>`,33);function _(g,f){const a=l("RouterLink");return t(),p("div",null,[r,d,k,m,n("h2",v,[h,s(" \u7F16\u5199\u4F60\u81EA\u5DF1\u7684item pipeline"),o(a,{to:"/posts/scrapy/chrome-extension:/lpmbefndcmjoaepdpgmoonafikcalmnf/data/reader/index.html?id=555&url=https%3A%2F%2Fscrapy-chs.readthedocs.io%2Fzh_CN%2Flatest%2Ftopics%2Fitem-pipeline.html#id1"},{default:i(()=>[s("\xB6")]),_:1})]),b])}const I=e(u,[["render",_],["__file","Item Pipeline.html.vue"]]);export{I as default};
