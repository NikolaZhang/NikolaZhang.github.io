import{_ as t}from"./_plugin-vue_export-helper.cdc0426e.js";import{o,c as p,a as n,b as s,d as e,e as c,r as i}from"./app.4001f435.js";const l={},r={href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html",target:"_blank",rel:"noopener noreferrer"},u=c(`<h2 id="\u6307\u5B9A\u5355\u4E2A\u51FD\u6570" tabindex="-1"><a class="header-anchor" href="#\u6307\u5B9A\u5355\u4E2A\u51FD\u6570" aria-hidden="true">#</a> \u6307\u5B9A\u5355\u4E2A\u51FD\u6570</h2><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;function_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;boost&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;random_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;boost_mode&quot;</span><span class="token operator">:</span><span class="token string">&quot;multiply&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>random_score</code>\u5C31\u662F\u4E00\u4E2A\u8BA1\u7B97\u51FD\u6570.</p><h2 id="\u6307\u5B9A\u591A\u4E2A\u51FD\u6570" tabindex="-1"><a class="header-anchor" href="#\u6307\u5B9A\u591A\u4E2A\u51FD\u6570" aria-hidden="true">#</a> \u6307\u5B9A\u591A\u4E2A\u51FD\u6570</h2><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;function_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;match_all&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;boost&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;functions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                  <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;random_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;weight&quot;</span><span class="token operator">:</span> <span class="token number">23</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                  <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cat&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token property">&quot;weight&quot;</span><span class="token operator">:</span> <span class="token number">42</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">&quot;max_boost&quot;</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
          <span class="token property">&quot;score_mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;max&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;boost_mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;multiply&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;min_score&quot;</span> <span class="token operator">:</span> <span class="token number">42</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F53\u6587\u6863\u5339\u914D\u5230\u5BF9\u5E94\u7684\u8FC7\u6EE4\u5668\u65F6, \u4F1A\u6267\u884C\u76F8\u5E94\u7684\u51FD\u6570. \u5982\u679C\u6CA1\u6709\u63D0\u4F9B\u51FD\u6570\u7684\u8FC7\u6EE4\u5668, \u5219\u7B49\u6548\u4E8E<code>&quot;match_all&quot;: {}</code></p><h3 id="score-mode\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#score-mode\u53C2\u6570" aria-hidden="true">#</a> score_mode\u53C2\u6570</h3><p><code>score_mode</code>\u8868\u793A\u8BA1\u7B97\u7684\u5206\u6570\u4F1A\u5982\u4F55\u88AB\u7EC4\u5408. \u6709\u4EE5\u4E0B\u53C2\u6570: <code>multiply</code>, <code>sum</code>, <code>avg</code>, <code>first</code>, <code>max</code>, <code>min</code> \u542B\u4E49\u5982\u540C\u5B57\u9762\u610F\u601D, \u8FD9\u91CC\u5355\u72EC\u8BF4\u4E00\u4E0B<code>first</code>, \u8868\u793A: \u4F7F\u7528\u7B2C\u4E00\u4E2A\u5339\u914D\u7684.</p><h3 id="weight\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#weight\u53C2\u6570" aria-hidden="true">#</a> weight\u53C2\u6570</h3><p>\u5F97\u5206\u53EF\u80FD\u6709\u4E0D\u540C\u7684\u57DF, \u800C\u4E14\u6709\u65F6\u4E0D\u540C\u51FD\u6570\u5BF9\u5206\u6570\u4EA7\u751F\u4E0D\u540C\u7A0B\u5EA6\u7684\u5F71\u54CD\u4E5F\u662F\u6211\u4EEC\u6240\u671F\u671B\u7684. \u901A\u8FC7\u4E3A\u6BCF\u4E2A\u51FD\u6570\u8BBE\u7F6E\u6743\u91CD<code>weight</code>\u6211\u4EEC\u53EF\u4EE5\u8FBE\u5230\u8C03\u6574\u5BF9\u5206\u6570\u7684\u5F71\u54CD. <code>weight</code>\u6700\u7EC8\u4F1A\u88AB\u5404\u81EA\u51FD\u6570\u7ED3\u679C\u4E58\u4E0A. \u5982\u679C\u6743\u91CD\u6CA1\u6709\u76F8\u5E94\u7684\u51FD\u6570, \u5219<code>weight</code>\u76F8\u5F53\u4E8E\u4E00\u4E2A\u8FD4\u56DE<code>weight</code>\u503C\u7684\u65B9\u6CD5.</p><p>\u5982\u679C<code>score_mode</code>\u88AB\u8BBE\u7F6E\u4E3A<code>avg</code>, \u6700\u7EC8\u7684\u5206\u6570\u4E3A\u52A0\u6743\u5E73\u5747. 1\u7684\u6743\u91CD\u662F3, 2\u7684\u6743\u91CD\u662F4, \u5219\u52A0\u6743\u5E73\u5747\u6BCF\u7ED3\u679C\u4E3A (1*3 + 2*4) / (3 + 4).</p><h3 id="max-boost\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#max-boost\u53C2\u6570" aria-hidden="true">#</a> max_boost\u53C2\u6570</h3><p>\u8BBE\u7F6E\u8BE5\u53C2\u6570\u53EF\u4EE5\u9632\u6B62\u65B0\u7684\u5206\u6570\u8D85\u8FC7\u67D0\u4E2A\u503C. \u9ED8\u8BA4\u60C5\u51B5\u4E0B, <code>max_boost</code>\u7684\u503C\u4E3A: <code>FLT_MAX</code>.</p><h3 id="boost-mode\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#boost-mode\u53C2\u6570" aria-hidden="true">#</a> boost_mode\u53C2\u6570</h3><p>\u65B0\u7684\u5206\u6570\u901A\u8FC7\u67E5\u8BE2\u5206\u6570\u548C\u51FD\u6570\u5206\u6570\u4EE5\u67D0\u79CD\u65B9\u5F0F<code>boost_mode</code>\u8FD0\u7B97\u5F97\u51FA. <code>boost_mode</code>\u7684\u503C\u53EF\u4EE5\u8BBE\u7F6E\u4E3A\u5982\u4E0B: <code>multiply</code>, <code>sum</code>, <code>avg</code>, <code>replace</code>, <code>max</code>, <code>min</code></p><p><code>replace</code>\u7684\u542B\u4E49\u662F\u53EA\u4F7F\u7528\u51FD\u6570\u5F97\u5206\u5FFD\u7565\u67E5\u8BE2\u5F97\u5206.</p><h3 id="min-score\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#min-score\u53C2\u6570" aria-hidden="true">#</a> min_score\u53C2\u6570</h3><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u4FEE\u6539\u5206\u6570\u4E0D\u4F1A\u66F4\u6539\u4E0E\u54EA\u4E2A\u6587\u6863\u5339\u914D\u3002\u8981\u6392\u9664\u4E0D\u7B26\u5408\u7279\u5B9A\u5206\u6570\u9608\u503C\u7684\u6587\u6863\uFF0C\u53EF\u4EE5\u5C06min_score\u53C2\u6570\u8BBE\u7F6E\u4E3A\u6240\u9700\u7684\u5206\u6570\u9608\u503C\u3002</p><p>\u8981min_score\u5DE5\u4F5C\uFF0C\u67E5\u8BE2\u8FD4\u56DE\u7684\u6240\u6709\u6587\u6863\u90FD\u9700\u8981\u7B97\u5206\uFF0C\u7136\u540E\u9010\u4E2A\u7B5B\u9009\u3002</p><h2 id="\u51FD\u6570\u79CD\u7C7B" tabindex="-1"><a class="header-anchor" href="#\u51FD\u6570\u79CD\u7C7B" aria-hidden="true">#</a> \u51FD\u6570\u79CD\u7C7B</h2><p>\u6709\u4EE5\u4E0B\u516D\u79CD\u51FD\u6570:</p><ul><li>script_score</li><li>weight</li><li>random_score</li><li>field_value_factor</li><li>decay functions: gauss, linear, exp</li></ul><h3 id="script-score" tabindex="-1"><a class="header-anchor" href="#script-score" aria-hidden="true">#</a> script score</h3><p>script_score\u51FD\u6570\u5141\u8BB8\u60A8\u5305\u88C5\u53E6\u4E00\u4E2A\u67E5\u8BE2\uFF0C\u5E76\u4F7F\u7528\u811A\u672C\u8868\u8FBE\u5F0F\u4ECE\u6587\u6863\u4E2D\u7684\u5176\u4ED6\u6570\u503C\u5B57\u6BB5\u503C\u6D3E\u751F\u7684\u8BA1\u7B97\u6765\u81EA\u5B9A\u4E49\u5B83\u7684\u8BC4\u5206\u3002\u4E0B\u9762\u662F\u4E00\u4E2A\u7B80\u5355\u7684\u793A\u4F8B\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;function_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;elasticsearch&quot;</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;script_score&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;script&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Math.log(2 + doc[&#39;likes&#39;].value)&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CE8\u610F: \u6240\u6709\u6587\u6863\u7684\u5F97\u90FD\u662F\u6B6332bit\u6D6E\u70B9\u6570. \u5982\u679C\u51FD\u6570\u751F\u6210\u66F4\u7CBE\u786E\u5730\u6D6E\u70B9\u6570, \u5219\u8F6C\u6362\u4E3A\u6700\u8FD1\u768432bit\u6D6E\u70B9\u6570. \u53E6\u5916\u5206\u6570\u4E0D\u80FD\u662F\u975E\u8D1F\u6570, \u5426\u5219\u4F1A\u51FA\u73B0\u9519\u8BEF.</p><p>\u5B9A\u4E49\u811A\u672C\u53C2\u6570, \u5E76\u5728\u811A\u672C\u4E2D\u4F7F\u7528:</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;function_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;elasticsearch&quot;</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;script_score&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;script&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">1.2</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;params.a / Math.pow(params.b, doc[&#39;likes&#39;].value)&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="weight" tabindex="-1"><a class="header-anchor" href="#weight" aria-hidden="true">#</a> weight</h3><p>\u5C06\u5206\u6570\u4E0E\u6743\u91CD\u76F8\u4E58.</p><h3 id="random-score" tabindex="-1"><a class="header-anchor" href="#random-score" aria-hidden="true">#</a> random_score</h3><p><code>random_score</code>\u751F\u6210[0,1)\u4E4B\u95F4\u7684\u5206\u6570\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u5B83\u4F7F\u7528\u5185\u90E8 Lucene \u6587\u6863 ID \u4F5C\u4E3A\u968F\u673A\u6027\u6E90\uFF0C\u8FD9\u975E\u5E38\u6709\u6548\uFF0C\u4F46\u4E0D\u5E78\u7684\u662F\u65E0\u6CD5\u91CD\u73B0\uFF0C\u56E0\u4E3A\u6587\u6863\u53EF\u80FD\u901A\u8FC7\u5408\u5E76\u91CD\u65B0\u7F16\u53F7\u3002</p><p>\u5982\u679C\u5E0C\u671B\u5206\u6570\u91CD\u73B0, \u5219\u9700\u8981\u63D0\u4F9B\u79CD\u5B50<code>seed</code>\u548C\u5B57\u6BB5<code>field</code>\u4E24\u4E2A\u53C2\u6570. \u6700\u7EC8\u7684\u5206\u6570\u7684\u8BA1\u7B97\u4F1A\u6839\u636E<code>seed</code>, \u6587\u6863\u7684<code>field</code>\u5B57\u6BB5\u7684\u6700\u5C0F\u503C, \u4EE5\u53CA\u57FA\u4E8E\u7D22\u5F15\u540D\u79F0\u548C\u5206\u7247 ID \u8BA1\u7B97\u7684\u76D0\u503C. \u4ECE\u800C\u542B\u6709\u76F8\u540C\u503C, \u4F46\u7D22\u5F15\u4E0D\u540C\u7684\u6587\u6863\u4F1A\u6709\u4E0D\u540C\u7684\u5F97\u5206.</p><p>\u540C\u4E00\u5206\u7247\u5185\u5177\u6709\u76F8\u540C<code>field</code>\u503C\u7684\u6587\u6863\u5C06\u83B7\u5F97\u76F8\u540C\u7684\u5206\u6570\uFF0C\u56E0\u6B64\u901A\u5E38\u9700\u8981\u4F7F\u7528\u5BF9\u6240\u6709\u6587\u6863\u5177\u6709\u552F\u4E00\u503C\u7684\u5B57\u6BB5\u3002\u6BD4\u8F83\u597D\u7684\u9009\u62E9\u53EF\u80FD\u662F\u4F7F\u7528<code>_seq_no</code>\u5B57\u6BB5\uFF0C\u5176\u552F\u4E00\u7F3A\u70B9\u662F\u5982\u679C\u6587\u6863\u66F4\u65B0\uFF0C\u5206\u6570\u5C06\u53D1\u751F\u53D8\u5316\uFF0C\u56E0\u4E3A\u66F4\u65B0\u64CD\u4F5C\u4E5F\u4F1A\u66F4\u65B0<code>_seq_no</code>\u5B57\u6BB5\u7684\u503C\u3002</p><p>\u53EF\u4EE5\u5728\u4E0D\u8BBE\u7F6E\u5B57\u6BB5\u7684\u60C5\u51B5\u4E0B\u8BBE\u7F6E\u79CD\u5B50\uFF0C\u4F46\u8FD9\u5DF2\u88AB\u5F03\u7528\uFF0C\u56E0\u4E3A\u8FD9\u9700\u8981\u5728\u5360\u7528\u5927\u91CF\u5185\u5B58\u7684_id\u5B57\u6BB5\u4E0A\u52A0\u8F7D\u5B57\u6BB5\u6570\u636E\u3002</p><h4 id="\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u6848\u4F8B" aria-hidden="true">#</a> \u6848\u4F8B</h4><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;function_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;random_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;seed&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_seq_no&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="field-value-factor" tabindex="-1"><a class="header-anchor" href="#field-value-factor" aria-hidden="true">#</a> field_value_factor</h3><p><code>field_value_factor</code>\u51FD\u6570\u5141\u8BB8\u4F7F\u7528\u6587\u6863\u4E2D\u7684\u5B57\u6BB5\u6765\u5F71\u54CD\u5206\u6570\u3002\u5B83\u7C7B\u4F3C\u4E8E\u4F7F\u7528<code>script_score</code>\u51FD\u6570\uFF0C\u4F46\u662F\uFF0C\u5B83\u907F\u514D\u4E86\u811A\u672C\u7684\u5F00\u9500\u3002\u5982\u679C\u5728\u591A\u503C\u5B57\u6BB5\u4E0A\u4F7F\u7528\uFF0C\u5219\u5728\u8BA1\u7B97\u4E2D\u4EC5\u4F7F\u7528\u8BE5\u5B57\u6BB5\u7684\u7B2C\u4E00\u4E2A\u503C\u3002</p><h4 id="\u4E3E\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u4E3E\u4F8B" aria-hidden="true">#</a> \u4E3E\u4F8B</h4><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;function_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;field_value_factor&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;likes&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;factor&quot;</span><span class="token operator">:</span> <span class="token number">1.2</span><span class="token punctuation">,</span>
                <span class="token property">&quot;modifier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sqrt&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;missing&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u7684\u67E5\u8BE2\u5BF9\u5E94\u7684\u8BA1\u7B97\u516C\u5F0F\u4E3A: <code>sqrt(1.2 * doc[&#39;likes&#39;].value)</code></p><h4 id="field-value-factor\u7684\u5B57\u6BB5" tabindex="-1"><a class="header-anchor" href="#field-value-factor\u7684\u5B57\u6BB5" aria-hidden="true">#</a> field_value_factor\u7684\u5B57\u6BB5</h4><table><thead><tr><th style="text-align:left;">\u5B57\u6BB5\u540D</th><th style="text-align:left;">\u542B\u4E49</th></tr></thead><tbody><tr><td style="text-align:left;">field</td><td style="text-align:left;">\u4ECE\u6587\u6863\u4E2D\u63D0\u53D6\u7684\u5B57\u6BB5</td></tr><tr><td style="text-align:left;">factor</td><td style="text-align:left;">\u9700\u8981\u4E58\u4E0A\u5B57\u6BB5\u503C\u7684\u64CD\u4F5C\u56E0\u5B50, \u9ED8\u8BA4\u503C\u4E3A1</td></tr><tr><td style="text-align:left;">modifier</td><td style="text-align:left;">\u5E94\u7528\u5230\u5B57\u6BB5\u503C\u7684\u4FEE\u9970\u7B26, \u53D6\u503C\u89C1\u4E0B\u8868</td></tr><tr><td style="text-align:left;">missing</td><td style="text-align:left;">\u5F53\u6587\u6863\u4E2D\u4E0D\u5B58\u5728\u63D0\u53D6\u7684\u5B57\u6BB5, \u5219\u4F7F\u7528\u8BE5\u5B57\u6BB5\u503C\u66FF\u4EE3</td></tr></tbody></table><h4 id="modifier\u53D6\u503C" tabindex="-1"><a class="header-anchor" href="#modifier\u53D6\u503C" aria-hidden="true">#</a> modifier\u53D6\u503C</h4><p><img src="https://tech.nikolazhang.top/2020-02-06-09-42-55.png" alt="2020-02-06-09-42-55" loading="lazy"></p><p>field_value_score\u51FD\u6570\u751F\u6210\u7684\u5206\u6570\u5FC5\u987B\u4E3A\u975E\u8D1F\u6570\uFF0C\u5426\u5219\u5C06\u5F15\u53D1\u9519\u8BEF\u3002\u5982\u679C\u5BF9 0 \u548C 1 \u4E4B\u95F4\u7684\u503C\u4F7F\u7528\uFF0C\u5219\u5BF9\u6570\u548C ln \u4FEE\u9970\u7B26\u5C06\u751F\u6210\u8D1F\u503C\u3002\u8BF7\u52A1\u5FC5\u4F7F\u7528\u8303\u56F4\u7B5B\u9009\u5668\u9650\u5236\u5B57\u6BB5\u7684\u503C\u4EE5\u907F\u514D\u8FD9\u79CD\u60C5\u51B5\uFF0C\u6216\u4F7F\u7528 log1p \u548C ln1p\u3002\u53E6\u5916\u4E5F\u8981\u907F\u514D\u5BF90\u53D6\u5BF9\u6570\u8FD9\u79CD\u975E\u903B\u8F91\u64CD\u4F5C.</p><h3 id="decay" tabindex="-1"><a class="header-anchor" href="#decay" aria-hidden="true">#</a> decay</h3><p>\u8870\u51CF\u51FD\u6570\u4F9D\u8D56\u4E8E\u7528\u6237\u7ED9\u5B9A\u7684<code>origin</code>\u6570\u503C\u578B\u95F4\u7684\u8DDD\u79BB\u8BA1\u7B97\u5F97\u5206. \u8FD9\u7C7B\u4F3C\u4E00\u4E2A\u8303\u56F4\u67E5\u8BE2, \u4F46\u662F\u8FB9\u7F18\u5E73\u6ED1\u800C\u4E0D\u662F\u6846\u5B9A\u5177\u4F53\u7684\u8FB9\u7F18\u503C.</p><p>\u8981\u5BF9\u5177\u6709\u6570\u5B57\u5B57\u6BB5\u7684\u67E5\u8BE2\u4F7F\u7528\u8DDD\u79BB\u8BC4\u5206\uFF0C\u7528\u6237\u5FC5\u987B\u4E3A\u6BCF\u4E2A\u5B57\u6BB5\u5B9A\u4E49<code>origin</code>\u548C<code>scale</code>\u3002\u9700\u8981<code>origin</code>\u6765\u5B9A\u4E49\u8BA1\u7B97\u8DDD\u79BB\u7684&quot;\u4E2D\u5FC3\u70B9&quot;\uFF0C<code>scale</code>\u7528\u6765\u5B9A\u4E49\u8870\u51CF\u7684\u901F\u7387. \u8870\u51CF\u51FD\u6570\u53EF\u4EE5\u5B9A\u4E49\u6210\u5982\u4E0B:</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;DECAY_FUNCTION&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;FIELD_NAME&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11, 12&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2km&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;offset&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0km&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;decay&quot;</span><span class="token operator">:</span> <span class="token number">0.33</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>DECAY_FUNCTION</code>\u53EF\u4EE5\u8BBE\u7F6E\u4E3A: <code>liner</code>, <code>exp</code>, <code>gauss</code>. <code>FIELD_NAME</code>\u5B57\u6BB5\u7684\u503C\u7C7B\u578B\u5FC5\u987B\u4E3Anumeric, date, geo-point.</p><p>\u5728\u4E0A\u9762\u7684\u793A\u4F8B\u4E2D\uFF0C\u5B57\u6BB5\u662Fgeo_point\uFF0C\u5E76\u4E14\u53EF\u4EE5\u4EE5\u5730\u7406\u683C\u5F0F\u63D0\u4F9B\u539F\u70B9\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u5FC5\u987B\u4F7F\u7528\u5355\u4F4D\u7ED9\u51FA\u6BD4\u4F8B\u548C\u504F\u79FB\u91CF\u3002\u5982\u679C\u5B57\u6BB5\u662F\u65E5\u671F\u5B57\u6BB5\uFF0C\u5219\u53EF\u4EE5\u5C06\u7F29\u653E\u548C\u504F\u79FB\u8BBE\u7F6E\u4E3A\u5929\u3001\u5468\u7B49\u3002\u5982:</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;function_score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;gauss&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;date&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                      <span class="token property">&quot;origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2013-09-17&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10d&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;offset&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5d&quot;</span><span class="token punctuation">,</span>
                      <span class="token property">&quot;decay&quot;</span> <span class="token operator">:</span> <span class="token number">0.5</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>origin</code>\u7684\u65E5\u671F\u683C\u5F0F\u7531\u6620\u5C04\u4E2D\u7684<code>format</code>\u5B9A\u4E49. \u5982\u679C\u4E0D\u8BBE\u7F6E<code>origin</code>,\u5219\u4F7F\u7528\u5F53\u524D\u65F6\u95F4. <code>offset</code>\u548C<code>decay</code>\u4E3A\u53EF\u9009\u5B57\u6BB5.</p><h4 id="\u5B57\u6BB5\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#\u5B57\u6BB5\u4ECB\u7ECD" aria-hidden="true">#</a> \u5B57\u6BB5\u4ECB\u7ECD</h4><table><thead><tr><th style="text-align:left;">\u5B57\u6BB5</th><th style="text-align:left;">\u63CF\u8FF0</th></tr></thead><tbody><tr><td style="text-align:left;">origin</td><td style="text-align:left;">\u7528\u4E8E\u8BA1\u7B97\u8DDD\u79BB\u7684\u539F\u70B9\u3002\u5FC5\u987B\u4E3A\u6570\u5B57\u5B57\u6BB5\u7684\u6570\u5B57\u3001\u65E5\u671F\u5B57\u6BB5\u7684\u65E5\u671F\u548C\u5730\u7406\u5B57\u6BB5\u7684\u5730\u7406\u70B9\u3002\u5BF9\u4E8E\u5730\u7406\u548C\u6570\u5B57\u5B57\u6BB5\u662F\u5FC5\u9700\u7684\u3002\u5BF9\u4E8E\u65E5\u671F\u5B57\u6BB5\uFF0C\u9ED8\u8BA4\u503C\u4E3Anow\u3002origin\u652F\u6301\u65E5\u671F\u8BA1\u7B97(\u5982: now - 1h).</td></tr><tr><td style="text-align:left;">scale</td><td style="text-align:left;">\u6240\u6709\u7C7B\u578B\u90FD\u9700\u8981\u3002\u5B9A\u4E49\u4E0E<code>origin + offset</code>\u7684\u8DDD\u79BB\u7B49\u4E8E\u8870\u51CF\u53C2\u6570\u3002\u5BF9\u4E8E\u5730\u7406\u5B57\u6BB5\uFF1A\u53EF\u4EE5\u5B9A\u4E49\u4E3A\u6570\u5B57\u5355\u4F4D\uFF081km\uFF0C12m,... \uFF09\u3002\u9ED8\u8BA4\u5355\u4F4D\u4E3A\u7C73\u3002\u5BF9\u4E8E\u65E5\u671F\u5B57\u6BB5\uFF1A\u53EF\u4EE5\u5B9A\u4E49\u4E3A\u6570\u5B57_\u5355\u4F4D \uFF08&quot;1h&quot;\uFF0C &quot;10d&quot;,... \uFF09\u3002\u9ED8\u8BA4\u5355\u4F4D\u4E3A\u6BEB\u79D2\u3002\u5BF9\u4E8E\u6570\u5B57\u5B57\u6BB5\uFF1A\u4EFB\u610F\u6570\u5B57\u3002</td></tr><tr><td style="text-align:left;">offset</td><td style="text-align:left;">\u5982\u679C\u5B9A\u4E49\u4E86\u504F\u79FB\u91CF\uFF0C\u5219\u8870\u51CF\u51FD\u6570\u5C06\u4EC5\u8BA1\u7B97\u8DDD\u79BB\u5927\u4E8E\u5B9A\u4E49\u7684\u504F\u79FB\u91CF\u7684\u6587\u6863\u7684\u8870\u51CF\u51FD\u6570\u3002\u9ED8\u8BA4\u503C\u4E3A 0\u3002</td></tr><tr><td style="text-align:left;">decay</td><td style="text-align:left;">\u8870\u51CF\u53C2\u6570\u5B9A\u4E49\u6587\u6863\u5982\u4F55\u901A\u8FC7<code>scale</code>\u8FDB\u884C\u8BC4\u5206\u3002\u5982\u679C\u672A\u5B9A\u4E49\u8870\u51CF\uFF0C\u5219\u8DDD\u79BB\u523B\u5EA6\u5904\u7684\u6587\u6863\u5C06\u8BC4\u52060.5\u3002</td></tr></tbody></table><p>\u7B2C\u4E00\u4E2A\u4F8B\u5B50\u4E2D\u6587\u6863\u53EF\u80FD\u5305\u542B\u5730\u7406\u4F4D\u7F6E\u5B57\u6BB5\u7684\u9152\u5E97\u4FE1\u606F. \u60A8\u5E0C\u671B\u6839\u636E\u9152\u5E97\u4E0E\u7ED9\u5B9A\u4F4D\u7F6E\u7684\u8FDC\u70B9\u8BA1\u7B97\u8870\u51CF\u51FD\u6570. \u4F60\u53EF\u80FD\u4E0D\u80FD\u7ACB\u523B\u77E5\u9053\u5982\u4F55\u6307\u5B9A\u9AD8\u65AF\u51FD\u6570\u7684<code>scale</code>, \u4F46\u662F\u4F60\u53EF\u80FD\u77E5\u9053&quot;\u57282km\u7684\u8DDD\u79BB\u4E0A\u5206\u6570\u5E94\u8BE5\u8870\u51CF\u52301/3&quot;. <code>scale</code>\u53C2\u6570\u5C06\u4F1A\u88AB\u81EA\u52A8\u8C03\u6574\u4EE5\u786E\u4FDD0.33\u7684\u5F97\u5206\u4F1A\u8DDD\u79BB\u7ED9\u5B9A\u70B92km.</p><p>\u5728\u7B2C\u4E8C\u4E2A\u793A\u4F8B\u4E2D\uFF0C\u5B57\u6BB5\u503C\u4ECB\u4E8E<code>2013-09-12</code>\u548C<code>2013-09-22</code>\u4E4B\u95F4\u7684\u6587\u6863\u5C06\u5F97\u52301.0\u7684\u6743\u91CD\uFF0C\u800C\u4ECE\u8BE5\u65E5\u671F\u8D77\u4E3A15\u5929\u7684\u6587\u6863\u6743\u91CD\u4E3A0.5\u3002</p><h4 id="\u8870\u51CF\u51FD\u6570" tabindex="-1"><a class="header-anchor" href="#\u8870\u51CF\u51FD\u6570" aria-hidden="true">#</a> \u8870\u51CF\u51FD\u6570</h4><p><code>DECAY_FUNCTION</code>\u7528\u6765\u786E\u5B9A\u4F7F\u7528\u4EC0\u4E48\u8870\u51CF\u51FD\u6570, \u652F\u6301\u7684\u8870\u51CF\u51FD\u6570\u89C1\u4E0B:</p><p><img src="https://tech.nikolazhang.top/2020-02-06-16-51-55.png" alt="2020-02-06-16-51-55" loading="lazy"></p><h3 id="\u591A\u503C\u5B57\u6BB5" tabindex="-1"><a class="header-anchor" href="#\u591A\u503C\u5B57\u6BB5" aria-hidden="true">#</a> \u591A\u503C\u5B57\u6BB5</h3><p>\u5982\u679C\u7528\u4E8E\u8BA1\u7B97\u8870\u51CF\u7684\u5B57\u6BB5\u5305\u542B\u591A\u4E2A\u503C\uFF0C\u5219\u6BCF\u4E2A\u9ED8\u8BA4\u503C\u9009\u62E9\u6700\u63A5\u8FD1\u539F\u70B9\u7684\u503C\u6765\u786E\u5B9A\u8DDD\u79BB\u3002\u8FD9\u53EF\u4EE5\u901A\u8FC7\u8BBE\u7F6E<code>multi_value_mode</code>, \u53D6\u503C\u4E3A: <code>min</code>, <code>max</code>, <code>avg</code>, <code>sum</code>.</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;DECAY_FUNCTION&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;FIELD_NAME&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;origin&quot;</span><span class="token operator">:</span> ...<span class="token punctuation">,</span>
            <span class="token property">&quot;scale&quot;</span><span class="token operator">:</span> ...
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;multi_value_mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;avg&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6700\u540E" tabindex="-1"><a class="header-anchor" href="#\u6700\u540E" aria-hidden="true">#</a> \u6700\u540E</h2>`,66),d={href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html",target:"_blank",rel:"noopener noreferrer"};function k(v,m){const a=i("ExternalLinkIcon");return o(),p("div",null,[n("blockquote",null,[n("p",null,[s("function_score\u5141\u8BB8\u81EA\u5B9A\u4E49\u5206\u6570\u8BA1\u7B97\u89C4\u5219, \u4FEE\u6539\u6587\u6863\u68C0\u7D22\u540E\u7684\u5F97\u5206. \u4F60\u53EF\u4EE5\u6307\u5B9A\u4E00\u4E2A\u6216\u9488\u5BF9\u4E0D\u540C\u60C5\u5F62\u6307\u5B9A\u4E0D\u540C\u7684\u89C4\u5219. \u4EE5\u4E0B\u5185\u5BB9\u6709\u4E9B\u67AF\u71E5, \u57FA\u672C\u4E0A\u662F\u5BF9"),n("a",r,[s("\u5B98\u65B9\u6587\u6863"),e(a)]),s("\u7684\u7FFB\u8BD1.")])]),u,n("p",null,[s("\u6709\u5174\u8DA3\u53EF\u4EE5\u9605\u8BFB"),n("a",d,[s("\u5B98\u65B9\u6587\u6863"),e(a)])])])}const h=t(l,[["render",k],["__file","elasticsearch\u7CFB\u5217[7]\u5165\u95E8-function.html.vue"]]);export{h as default};
