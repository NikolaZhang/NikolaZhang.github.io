import{_ as p}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as e,c as o,a as n,b as a,d as c,e as s,r as i}from"./app.4001f435.js";const l={},u=s(`<blockquote><p>\u524D\u51E0\u7BC7\u6587\u7AE0\u4ECB\u7ECD\u4E86scrapy\u76F8\u5173\u7684\u77E5\u8BC6. \u8FD9\u7BC7\u6587\u7AE0\u6765\u4ECB\u7ECD\u4E00\u4E2A\u6211\u81EA\u5DF1\u5199\u7684\u722C\u866Bdemo. \u901A\u8FC7\u5173\u952E\u8BCD\u67E5\u8BE2\u722C\u53D6\u76F8\u5173\u7684csdn\u6587\u7AE0.</p></blockquote><h2 id="\u9879\u76EE\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#\u9879\u76EE\u4ECB\u7ECD" aria-hidden="true">#</a> \u9879\u76EE\u4ECB\u7ECD</h2><h3 id="\u722C\u866B\u7C7Bcsdnarticlerelatedspider" tabindex="-1"><a class="header-anchor" href="#\u722C\u866B\u7C7Bcsdnarticlerelatedspider" aria-hidden="true">#</a> \u722C\u866B\u7C7BCsdnArticleRelatedSpider</h3><p><code>CsdnArticleRelatedSpider</code>\u7EE7\u627F<code>CrawlSpider</code>, \u901A\u8FC7\u5B9A\u4E49\u89C4\u5219<code>rules</code>\u5C5E\u6027\u4ECE\u9875\u9762\u63D0\u53D6\u94FE\u63A5. \u8FD9\u91CC\u6211\u4EEC\u5B9A\u4E49\u4E86\u4ECE\u83B7\u53D6\u6587\u7AE0\u8BE6\u60C5\u9875\u7684\u94FE\u63A5\u63D0\u53D6\u89C4\u5219:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>rules <span class="token operator">=</span> <span class="token punctuation">(</span>
    Rule<span class="token punctuation">(</span>LinkExtractor<span class="token punctuation">(</span><span class="token string">&#39;.*/article/details/.*&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span><span class="token string">&#39;parse_item&#39;</span><span class="token punctuation">,</span> follow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6587\u7AE0\u8BE6\u60C5\u9875\u7684\u5B57\u6BB5\u63D0\u53D6\u65B9\u6CD5\u53EF\u4EE5\u901A\u8FC7<code>callback</code>\u5C5E\u6027\u8FDB\u884C\u6307\u5B9A, \u5B57\u6BB5\u7684\u63D0\u53D6\u4F7F\u7528xpath\u5B9E\u73B0:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">parse_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&#39;[CsdnArticleSpider details] start to deal [{}]&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
    item_loader <span class="token operator">=</span> ItemLoader<span class="token punctuation">(</span>item<span class="token operator">=</span>CsdnArticleItem<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> response<span class="token operator">=</span>response<span class="token punctuation">)</span>
    item_loader<span class="token punctuation">.</span>add_value<span class="token punctuation">(</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
    item_loader<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;//*[@id=&quot;articleContentId&quot;]/text()&#39;</span><span class="token punctuation">)</span>
    item_loader<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;author&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;//div[@class=&quot;bar-content&quot;]/a[@class=&quot;follow-nickName &quot;]/text()&#39;</span><span class="token punctuation">)</span>
    item_loader<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;post_time&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;//div[@class=&quot;bar-content&quot;]/span[@class=&quot;time&quot;]/text()&#39;</span><span class="token punctuation">)</span>

    item_loader<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;type_label&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;//div[@class=&quot;tags-box artic-tag-box&quot;]&#39;</span>
                                        <span class="token string">&#39;/a[contains(@href, &quot;category&quot;)]/text()&#39;</span><span class="token punctuation">)</span>
    item_loader<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;type_label_url&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;//div[@class=&quot;tags-box artic-tag-box&quot;]&#39;</span>
                                            <span class="token string">&#39;/a[contains(@href, &quot;category&quot;)]/@href&#39;</span><span class="token punctuation">)</span>
    item_loader<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;article_label&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;//div[@class=&quot;tags-box artic-tag-box&quot;]&#39;</span>
                                            <span class="token string">&#39;/a[contains(@href, &quot;tags&quot;)]/text()&#39;</span><span class="token punctuation">)</span>
    item_loader<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;article_label_url&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;//div[@class=&quot;tags-box artic-tag-box&quot;]&#39;</span>
                                                <span class="token string">&#39;/a[contains(@href, &quot;tags&quot;)]/@href&#39;</span><span class="token punctuation">)</span>

    item_loader<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;view_cnt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;//span[@class=&quot;read-count&quot;]/text()&#39;</span><span class="token punctuation">)</span>
    item_loader<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;like_cnt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;//span[@id=&quot;spanCount&quot;]/text()&#39;</span><span class="token punctuation">)</span>
    item_loader<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;collect_cnt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;//span[@id=&quot;get-collection&quot;]/text()&#39;</span><span class="token punctuation">)</span>
    item_loader<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;comment_cnt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;//a[@href=&quot;#commentBox&quot;]/span[@class=&quot;count&quot;]/text()&#39;</span><span class="token punctuation">)</span>
    item_loader<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;content_html&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;//div[@id=&quot;content_views&quot;]&#39;</span><span class="token punctuation">)</span>
    item <span class="token operator">=</span> item_loader<span class="token punctuation">.</span>load_item<span class="token punctuation">(</span><span class="token punctuation">)</span>
    set_default<span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">&quot;type_label&quot;</span><span class="token punctuation">)</span>
    set_default<span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">&quot;article_label&quot;</span><span class="token punctuation">)</span>
    set_default<span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> item

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6587\u7AE0\u4FE1\u606F\u7C7Bcsdnarticleitem" tabindex="-1"><a class="header-anchor" href="#\u6587\u7AE0\u4FE1\u606F\u7C7Bcsdnarticleitem" aria-hidden="true">#</a> \u6587\u7AE0\u4FE1\u606F\u7C7BCsdnArticleItem</h3><p><code>CsdnArticleItem</code>\u7C7B\u662F\u6211\u4EEC\u5C01\u88C5\u7684\u6587\u7AE0\u4FE1\u606F\u7C7B.</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">class</span> <span class="token class-name">CsdnArticleItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    csdn\u6587\u7AE0
    &quot;&quot;&quot;</span>
    title <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>output_processor<span class="token operator">=</span>TakeFirst<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    author <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>output_processor<span class="token operator">=</span>TakeFirst<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    post_time <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>output_processor<span class="token operator">=</span>TakeFirst<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    type_label <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>input_processor<span class="token operator">=</span>MapCompose<span class="token punctuation">(</span>remove_blank<span class="token punctuation">)</span><span class="token punctuation">,</span>
                              output_processor<span class="token operator">=</span>Join<span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    type_label_url <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>output_processor<span class="token operator">=</span>Join<span class="token punctuation">(</span><span class="token string">&quot;,\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    article_label <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>input_processor<span class="token operator">=</span>MapCompose<span class="token punctuation">(</span>remove_blank<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                 output_processor<span class="token operator">=</span>Join<span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    article_label_url <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>output_processor<span class="token operator">=</span>Join<span class="token punctuation">(</span><span class="token string">&quot;,\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    view_cnt <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>input_processor<span class="token operator">=</span>MapCompose<span class="token punctuation">(</span>remove_blank<span class="token punctuation">,</span> set_zero<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            output_processor<span class="token operator">=</span>TakeFirst<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    like_cnt <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>input_processor<span class="token operator">=</span>MapCompose<span class="token punctuation">(</span>remove_blank<span class="token punctuation">,</span> set_zero<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            output_processor<span class="token operator">=</span>TakeFirst<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    collect_cnt <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>input_processor<span class="token operator">=</span>MapCompose<span class="token punctuation">(</span>remove_blank<span class="token punctuation">,</span> set_zero<span class="token punctuation">)</span><span class="token punctuation">,</span>
                               output_processor<span class="token operator">=</span>TakeFirst<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    comment_cnt <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>input_processor<span class="token operator">=</span>MapCompose<span class="token punctuation">(</span>remove_blank<span class="token punctuation">,</span> set_zero<span class="token punctuation">)</span><span class="token punctuation">,</span>
                               output_processor<span class="token operator">=</span>TakeFirst<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    url <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>input_processor<span class="token operator">=</span>MapCompose<span class="token punctuation">(</span>remove_blank<span class="token punctuation">)</span><span class="token punctuation">,</span>
                       output_processor<span class="token operator">=</span>TakeFirst<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    file_path <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>input_processor<span class="token operator">=</span>MapCompose<span class="token punctuation">(</span>remove_blank<span class="token punctuation">)</span><span class="token punctuation">)</span>
    content_html <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span>input_processor<span class="token operator">=</span>MapCompose<span class="token punctuation">(</span>remove_blank<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                output_processor<span class="token operator">=</span>TakeFirst<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>input_processor</code>\u548C<code>output_processor</code>\u65B9\u6CD5\u662F\u5BF9\u5B57\u6BB5\u8FDB\u884C\u524D\u7F6E\u548C\u540E\u7F6E\u5904\u7406\u7684\u5C5E\u6027.</p><p>\u4E4B\u540E\u901A\u8FC7\u722C\u866B\u7C7B\u4E2D\u7684<code>ItemLoader</code>\u7684<code>load_item</code>\u65B9\u6CD5\u53EF\u4EE5\u521B\u5EFA<code>CsdnArticleItem</code>\u7684\u5B9E\u4F8B.</p><p>\u4F46\u662F\u8FD9\u91CC\u6709\u4E00\u4E2A\u95EE\u9898, \u5982\u679C\u722C\u866B\u7C7B\u901A\u8FC7xpath\u65E0\u6CD5\u83B7\u53D6\u5230\u5B57\u6BB5\u503C, \u90A3\u4E48\u8FD9\u4E2A\u5B57\u6BB5\u662F\u4E0D\u5B58\u5728\u7684. \u56E0\u6B64\u5728\u4E0A\u4E00\u8282\u4E2D<code>load_item</code>\u65B9\u6CD5\u8C03\u7528\u4E4B\u540E, \u6211\u4EEC\u53C8\u901A\u8FC7<code>set_default</code>\u65B9\u6CD5\u6307\u5B9A\u9ED8\u8BA4\u7684\u53C2\u6570.</p><p>\u5176\u65B9\u6CD5\u5B9A\u4E49\u4E3A:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">set_default</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> item<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            item<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;unknown&quot;</span>
    <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>
        item<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;unknown&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u7BA1\u9053\u7684\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#\u7BA1\u9053\u7684\u4F7F\u7528" aria-hidden="true">#</a> \u7BA1\u9053\u7684\u4F7F\u7528</h3><p>\u4E0A\u9762\u7684item\u521B\u5EFA\u4E4B\u540E\u4F1A\u4F20\u9012\u5230\u7BA1\u9053\u4E2D\u53BB. \u6309\u7167settings.py\u6587\u4EF6\u4E2D\u6307\u5B9A\u7684\u987A\u5E8F\u5BF9item\u8FDB\u884C\u5904\u7406. \u8FD9\u91CC\u6211\u4EEC\u4F7F\u7528\u4E86\u4E09\u4E2A\u7BA1\u9053.</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&#39;article.pipelines.PrePipeline.DuplicatePipeline&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">&#39;article.pipelines.PostExportPipeline.MarkdownPipeline&#39;</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token string">&#39;article.pipelines.PostExportPipeline.CsvPipeline&#39;</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="duplicatepipeline" tabindex="-1"><a class="header-anchor" href="#duplicatepipeline" aria-hidden="true">#</a> DuplicatePipeline</h4><p>\u8BE5\u7BA1\u9053\u7528\u4E8E\u53BB\u91CD. \u5982\u679C\u4E4B\u524D\u5DF2\u7ECF\u722C\u53D6\u8FC7\u5F53\u524D\u6587\u7AE0\u5219\u4E0D\u4F1A\u7EE7\u7EED\u5F80\u4E0B\u9762\u7684\u7BA1\u9053\u7EE7\u7EED\u4F20\u8F93.</p><p>\u8BE5\u7C7B\u7684\u5B9E\u73B0\u89C1\u4E0B:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">class</span> <span class="token class-name">DuplicatePipeline</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    \u53BB\u91CD \u8BFB\u53D6\u4E4B\u524D\u5BFC\u51FA\u8BB0\u5F55\u7684url\u653E\u5230\u96C6\u5408\u4E2D, \u6BCF\u6B21\u83B7\u53D6\u5230\u65B0\u7684\u94FE\u63A5\u4E4B\u540E\u5224\u65AD\u662F\u5426\u5B58\u5728
    \u5982\u679C\u4E4B\u524D\u5B58\u5728\u5219\u4E0D\u8FDB\u884C\u5904\u7406
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        csv_path <span class="token operator">=</span> config<span class="token punctuation">[</span><span class="token string">&quot;record_path&quot;</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>csv_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>csv_path<span class="token punctuation">)</span>
                logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">&#39;\u83B7\u53D6\u5230\u7684\u6570\u636E\u4E3A: {}&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>urls <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> EmptyDataError<span class="token punctuation">:</span>
                logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">&#39;\u6587\u4EF6\u5185\u5BB9\u4E3A\u7A7A&#39;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">]</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>urls<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> DropItem<span class="token punctuation">(</span><span class="token string">&quot;Duplicate item found: title: [%s] url: [%s]&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">[</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>urls<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> item

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521D\u59CB\u5316\u65B9\u6CD5\u4E2D, \u52A0\u8F7D\u5386\u53F2\u7684url. \u8FD9\u4E9Burl\u8BB0\u5F55\u5728<code>record_path</code>\u6240\u6307\u5B9A\u7684\u6587\u4EF6\u4E2D.</p><p><code>process_item</code>\u65B9\u6CD5\u662F\u8FDB\u884C\u53BB\u91CD\u5B9E\u73B0\u7684. \u5982\u679Curl\u5DF2\u7ECF\u5B58\u5728\u76F4\u63A5\u629B\u51FA<code>DropItem</code>\u5F02\u5E38\u5373\u53EF. \u5982\u679C\u4E0D\u5B58\u5728\u6211\u4EEC\u5C06url\u52A0\u5165\u5230<code>urls</code>\u96C6\u5408\u4E2D\u53BB.</p><h4 id="markdownpipeline" tabindex="-1"><a class="header-anchor" href="#markdownpipeline" aria-hidden="true">#</a> MarkdownPipeline</h4><blockquote><p>\u8BE5\u7BA1\u9053\u7528\u4E8E\u5C06markdown\u6587\u4EF6\u8FDB\u884C\u5BFC\u51FA</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MarkdownPipeline</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>save_markdown<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">return</span> item

    <span class="token keyword">def</span> <span class="token function">save_markdown</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token triple-quoted-string string">&quot;&quot;&quot;
      \u4FDD\u5B58\u6587\u7AE0\u5185\u5BB9\u4E3Amd\u683C\u5F0F
      &quot;&quot;&quot;</span>
      title <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">]</span>
      author <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">&#39;author&#39;</span><span class="token punctuation">]</span>
      label <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">&#39;article_label&#39;</span><span class="token punctuation">]</span>
      <span class="token comment"># \u9700\u8981\u5BF9\u5B57\u7B26\u4E32\u8FDB\u884C\u683C\u5F0F\u5316\u5904\u7406</span>
      author <span class="token operator">=</span> remove_strange_char<span class="token punctuation">(</span>author<span class="token punctuation">)</span>
      title <span class="token operator">=</span> remove_strange_char<span class="token punctuation">(</span>title<span class="token punctuation">)</span>
      label <span class="token operator">=</span> remove_strange_char<span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token comment"># \u6309\u7167\u6587\u7AE0\u5206\u7C7B/\u4F5C\u8005\u5C42\u7EA7\u521B\u5EFA\u76EE\u5F55\u5E76\u4FDD\u5B58</span>
      dir_article <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>config<span class="token punctuation">[</span><span class="token string">&#39;target_path&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> author<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>dir_article<span class="token punctuation">)</span><span class="token punctuation">:</span>
          os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>dir_article<span class="token punctuation">)</span>

      file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>config<span class="token punctuation">[</span><span class="token string">&#39;target_path&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> author<span class="token punctuation">,</span> title <span class="token operator">+</span> <span class="token string">&#39;.md&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
          item<span class="token punctuation">[</span><span class="token string">&#39;file_path&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> file_path
          content_html <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">&#39;content_html&#39;</span><span class="token punctuation">]</span>
          <span class="token keyword">if</span> content_html<span class="token punctuation">:</span>
              content_md <span class="token operator">=</span> ht<span class="token punctuation">.</span>HTML2Text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>handle<span class="token punctuation">(</span>content_html<span class="token punctuation">)</span>
              <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&#39;UTF-8&#39;</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">&#39;w+&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> md_file<span class="token punctuation">:</span>
                  md_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content_md<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5C06html\u8F6C\u6362\u4E3Amd\u683C\u5F0F\u6211\u4EEC\u4F7F\u7528\u4E86html2text\u7B2C\u4E09\u65B9\u4F9D\u8D56. \u8FD9\u91CC\u53EF\u4EE5\u5B9A\u5236\u5316\u81EA\u5DF1\u7684\u8F93\u51FA\u8DEF\u5F84.</p><h4 id="csvpipeline" tabindex="-1"><a class="header-anchor" href="#csvpipeline" aria-hidden="true">#</a> CsvPipeline</h4><p>\u8BE5\u7BA1\u9053\u7528\u4E8E\u8BB0\u5F55\u722C\u53D6\u5386\u53F2. \u8FD9\u91CC\u6211\u4EEC\u4F7F\u7528<code>CsdnArticleItemExporter</code>\u8FDB\u884Ccvs\u7684\u5BFC\u51FA. \u8BE5\u7C7B\u7EE7\u627F\u81EA<code>CsvItemExporter</code>, \u6211\u4EEC\u53EA\u9700\u8981\u5728\u521D\u59CB\u5316\u65B9\u6CD5\u4E2D\u63D0\u4F9B\u4E00\u4E9B\u5C5E\u6027\u503C\u5373\u53EF, \u6700\u540E\u8C03\u7528\u7236\u7C7B\u7684\u521D\u59CB\u5316\u65B9\u6CD5.</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">CsvPipeline</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    \u5C06item\u5B58\u4E3Axlsx
    &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>exporter <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">open_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>config<span class="token punctuation">[</span><span class="token string">&#39;record_path&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;w+b&#39;</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>files<span class="token punctuation">[</span>spider<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">file</span>
        self<span class="token punctuation">.</span>exporter <span class="token operator">=</span> CsdnArticleItemExporter<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>exporter<span class="token punctuation">.</span>start_exporting<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">close_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>exporter<span class="token punctuation">.</span>finish_exporting<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token builtin">file</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>files<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>spider<span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> item<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>exporter<span class="token punctuation">.</span>export_item<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            <span class="token keyword">return</span> item

<span class="token keyword">class</span> <span class="token class-name">CsdnArticleItemExporter</span><span class="token punctuation">(</span>CsvItemExporter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    \u6587\u7AE0\u8BB0\u5F55\u7684\u5BFC\u51FA\u683C\u5F0F\u8BBE\u7F6E, \u6309\u7167FIELDS_TO_EXPORT\u4E2D\u6307\u5B9A\u7684\u987A\u5E8F\u5BFC\u51FA\u5404\u4E2A\u5B57\u6BB5
    &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        delimiter <span class="token operator">=</span> config<span class="token punctuation">[</span><span class="token string">&#39;csv_delimiter&#39;</span><span class="token punctuation">]</span>
        kwargs<span class="token punctuation">[</span><span class="token string">&#39;delimiter&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> delimiter

        fields_to_export <span class="token operator">=</span> config<span class="token punctuation">[</span><span class="token string">&#39;fields_to_export&#39;</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> fields_to_export<span class="token punctuation">:</span>
            kwargs<span class="token punctuation">[</span><span class="token string">&#39;fields_to_export&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> fields_to_export

        <span class="token builtin">super</span><span class="token punctuation">(</span>CsdnArticleItemExporter<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5982\u4F55\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u914D\u7F6E" aria-hidden="true">#</a> \u5982\u4F55\u914D\u7F6E</h2><p>\u8FD9\u91CC\u9700\u8981\u63D0\u53CA3\u4E2A\u914D\u7F6E\u6587\u4EF6.</p>`,33),r=s(`<li><p>scrapy.cfg \u8FD9\u4E2A\u662Fscrapy\u6846\u67B6\u7684\u914D\u7F6E\u6587\u4EF6, \u8FD9\u91CC\u6211\u4EEC\u6307\u5B9A\u4E86settings\u6587\u4EF6\u540D. \u56E0\u6B64settings.py\u6587\u4EF6\u4E2D\u7684\u5C5E\u6027\u90FD\u4F1A\u52A0\u8F7D\u5230settings\u5C5E\u6027\u4E2D\u53BB.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>  [settings]
  default = article.csdn_article_settings
  ;default = src.csdn_query_settings

  [deploy]
  project = csdn_spider

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>`,1),d={href:"https://scrapy-chs.readthedocs.io/zh_CN/0.24/topics/settings.html",target:"_blank",rel:"noopener noreferrer"},k=s(`<li><p>config.json \u8FD9\u4E2A\u6587\u4EF6\u662F\u6211\u4EEC\u81EA\u5B9A\u4E49\u7684\u914D\u7F6E\u9879, \u7528\u4E8E\u72EC\u7ACB\u4E8E\u8BE5\u6846\u67B6\u8FDB\u884C\u914D\u7F6E. \u5728main\u7C7B\u4E2D\u6211\u4EEC\u5BF9\u8BFB\u53D6\u5176\u4E2D\u7684\u914D\u7F6E, \u5C06\u5176\u52A0\u8F7D\u5230\u5168\u5C40\u53D8\u91CF\u4E2D\u53BB.</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;csdn_article&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;query_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://so.csdn.net/api/v3/search?q=&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token string">&quot;java \u53CD\u5C04&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start_urls&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;record_path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;D:\\\\data\\\\article\\\\record.csv&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;target_path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;D:\\\\data\\\\article\\\\&quot;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6BD4\u5982\u8FD9\u91CC\u6211\u4EEC\u914D\u7F6E\u4E86\u521D\u59CB\u5316\u65F6\u7684url, \u5DF2\u7ECF\u6587\u4EF6\u7684\u5BFC\u51FA\u8DEF\u5F84.</p></li>`,1),v=s('<h2 id="\u5982\u4F55\u8FD0\u884C" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u8FD0\u884C" aria-hidden="true">#</a> \u5982\u4F55\u8FD0\u884C</h2><p>\u76F4\u63A5\u8FD0\u884C<code>main.py</code>, \u6CE8\u610F\u9700\u8981\u6DFB\u52A0<code>--config=D:\\XXXXX\\config.json</code>\u8BE5\u6587\u4EF6\u5373\u4F60\u7684json\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84.</p><p>csv\u4E2D\u7684\u722C\u53D6\u8BB0\u5F55: <img src="https://tech-nikola.oss-cn-shanghai.aliyuncs.com/result/spider/\u722C\u53D6\u8BB0\u5F55.png" alt="csv\u4E2D\u7684\u722C\u53D6\u8BB0\u5F55" loading="lazy"></p><p>\u722C\u53D6\u7684\u6587\u4EF6: <img src="https://tech-nikola.oss-cn-shanghai.aliyuncs.com/result/spider/\u722C\u53D6\u7684\u6587\u4EF6.png" alt="\u722C\u53D6\u7684\u6587\u4EF6" loading="lazy"></p><p>\u722C\u53D6\u6587\u4EF6\u8DEF\u5F84: <img src="https://tech-nikola.oss-cn-shanghai.aliyuncs.com/result/spider/\u722C\u53D6\u6587\u4EF6\u8DEF\u5F84.png" alt="\u722C\u53D6\u6587\u4EF6\u8DEF\u5F84" loading="lazy"></p>',5);function m(b,_){const t=i("ExternalLinkIcon");return e(),o("div",null,[u,n("ul",null,[r,n("li",null,[n("p",null,[a("csdn_article_settings.py \u8BE5\u6587\u4EF6\u7528\u4E8E\u8BBE\u7F6E\u722C\u866B\u8FD0\u884C\u6240\u9700\u8981\u7684\u73AF\u5883\u914D\u7F6E. \u6240\u6709\u7684\u914D\u7F6E\u9879\u53EF\u4EE5\u53C2\u8003"),n("a",d,[a("settings\u914D\u7F6E"),c(t)])])]),k]),v])}const q=p(l,[["render",m],["__file","\u722C\u53D6csdn\u6587\u7AE0.html.vue"]]);export{q as default};
